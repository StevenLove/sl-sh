#!/bin/sl-sh

(core::ns-import 'core)
(ns-import 'shell)

(defq tests-dir "tests")

(defn all-items-by-whitespace (producer)
	(str-trim (str (| (producer) (tr "\n" " ") (tr -s ":blank:")))))


(defq test-list (str-split " " (all-items-by-whitespace (fn () (ls tests-dir)))))

(defn report-pretty-printer (pass test-name)
	  (if (= pass 0)
		(println
			(str shell::*fg-black* shell::*bg-green*
			"PASS:"
			shell::*fg-default* shell::*bg-default*
			" " test-name))
		(println
			(str shell::*fg-black* shell::*bg-red*
			"FAIL:"
			shell::*fg-default* shell::*bg-default*
			" " test-name))))

(defn report-test-results (tests)
	(progn
		(defq fst (first tests))
		(when fst
			(progn
				(defq fp (str tests-dir "/" fst))
				(defq res (wait (sl-sh fp)))
				(report-pretty-printer res fp)
				(recur (rest tests))))))

(report-test-results test-list)


